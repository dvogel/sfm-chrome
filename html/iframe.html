<!DOCTYPE html>

<html>
	<head>
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
		<script type="text/javascript">
			var replaceSelf = function (page) {
				document.open();
				document.writeln(page);
				document.close();
			};

			chrome.extension.sendRequest({'method': 'whoami?'}, function(tab){

				chrome.extension.sendRequest({'method': 'getOptions'}, function(options){

					chrome.extension.sendRequest({'method': 'getSearchResults', 'tab': tab}, function(results){
						var query_params = {
							'text': results['text'],
							'title': results['title']
						};
						var url = options.search_server + '/sidebyside/chrome/search/';
						$.ajax({
							"type": "POST",
							"crossDomain": true,
							"cache": false,
							"url": url,
							"data": query_params,
							"success": replaceSelf
						});
					});
				});
			});
		</script>
	</head>
	<body>
	</body>
</html>

